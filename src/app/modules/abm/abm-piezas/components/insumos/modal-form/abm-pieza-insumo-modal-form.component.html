<!-- <h1 mat-dialog-title>Añadir Insumo</h1> -->
<div mat-dialog-content class="px-0">
  <form [formGroup]="insumoForm" class="mat-form-without-wrapper">
    <mat-tab-group>
      <mat-tab label="Datos Insumo">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 px-4">
          <div class="col-span-1">
            <ng-container *ngFor="let nivel of nivelesTipoInsumo; let i = index">
              <mat-form-field appearance="outline" class="w-full" *ngIf="tiposFormArray.controls[i]">
                <mat-label>Tipo de Insumo (Nivel {{ i + 1 }})</mat-label>
                <mat-select [formControl]="tiposFormArray.controls[i]" [compareWith]="compareTipoFn"
                  (selectionChange)="onTipoSeleccionado($event.value, i)">
                  <mat-option *ngFor="let tipo of nivel" [value]="tipo">
                    {{ tipo.nombre }}
                  </mat-option>
                </mat-select>
                <mat-error *ngIf="tiposFormArray.controls[i].hasError('required')">
                  El tipo de insumo es requerido
                </mat-error>
              </mat-form-field>
            </ng-container>
          </div>

          <div class="col-span-1 md:col-span-2">
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Insumo</mat-label>
              <input type="text" matInput formControlName="insumo" [matAutocomplete]="auto">
              <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayFn">
                <mat-option *ngFor="let insumo of insumos$ | async" [value]="insumo">
                  {{ insumo.nombre }}
                </mat-option>
              </mat-autocomplete>
              <mat-error *ngIf="insumoForm.get('insumo').hasError('required')">El insumo es requerido</mat-error>
            </mat-form-field>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <mat-form-field appearance="outline" class="w-full">
                <mat-label>Medida (Valor)</mat-label>
                <input matInput type="number" formControlName="medidaValor">
              </mat-form-field>

              <mat-form-field appearance="outline" class="w-full">
                <mat-label>Medida (Observaciones)</mat-label>
                <input matInput type="text" formControlName="medidaObservaciones">
              </mat-form-field>
            </div>

            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Tratamiento</mat-label>
              <input type="text" matInput formControlName="tratamiento" [matAutocomplete]="autoTratamiento">
              <mat-autocomplete #autoTratamiento="matAutocomplete">
                <mat-option *ngFor="let tratamiento of ['Tratamiento A', 'Tratamiento B', 'Tratamiento C']"
                  [value]="tratamiento">
                  {{ tratamiento }}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-full without-wrapper">
              <mat-label>Añadir Adhesivos</mat-label>
              <input type="text" matInput [formControl]="adhesivoCtrl" [matAutocomplete]="autoAdhesivo">
              <mat-autocomplete #autoAdhesivo="matAutocomplete">
                <mat-option *ngFor="let adhesivo of filteredAdhesivos$ | async" [value]="adhesivo">
                  {{ adhesivo }}
                </mat-option>
              </mat-autocomplete>
              <button mat-icon-button matSuffix type="button" (click)="agregarAdhesivo()">
                <mat-icon>add</mat-icon>
              </button>
            </mat-form-field>

            <div class="flex flex-wrap gap-2 mt-2">
              <mat-chip-list aria-label="Adhesivos">
                <mat-chip *ngFor="let adhesivo of adhesivosAgregados" (removed)="quitarAdhesivo(adhesivo)">
                  {{ adhesivo }}
                  <button matChipRemove>
                    <mat-icon>cancel</mat-icon>
                  </button>
                </mat-chip>
              </mat-chip-list>
            </div>

          </div>
        </div>
      </mat-tab>

      <mat-tab label="Observaciones">
        <div class="px-4">
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Observaciones</mat-label>
            <textarea matInput formControlName="observaciones"></textarea>
          </mat-form-field>
        </div>
      </mat-tab>
    </mat-tab-group>
  </form>
</div>
<div mat-dialog-actions class="justify-end">
  <div class="flex shrink-0 items-center gap-2 flex-row-reverse">
    <button mat-flat-button (click)="onSave()" [disabled]="insumoForm.invalid"
      class="mat-focus-indicator mat-flat-button mat-button-base mat-accent min-w-max w-full max-w-30">
      <span class="mat-button-wrapper">
        Guardar
      </span>
      <span matripple="" class="mat-ripple mat-button-ripple"></span>
    </button>

    <button mat-stroked-button (click)="onCancel()"
      class="mat-focus-indicator mat-stroked-button mat-button-base min-w-max w-full max-w-30">
      <span class="mat-button-wrapper"> Cancelar </span>
      <span matripple="" class="mat-ripple mat-button-ripple"></span>
    </button>
  </div>
</div>